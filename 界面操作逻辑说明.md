## å½“å‰ç•Œé¢æ“ä½œé€»è¾‘è¯´æ˜

### 1. ç•Œé¢å¸ƒå±€ç»“æ„
```
ä¸»çª—å£ (RealTimePlotWindow)
â”œâ”€â”€ æ§åˆ¶é¢æ¿åŒºåŸŸ
â”‚   â”œâ”€â”€ WiFi è®¾ç½® (ON/OFF)
â”‚   â”œâ”€â”€ CAN è®¾ç½® (ON/OFF)
â”‚   â”œâ”€â”€ AC è®¾ç½® (ON/OFF)
â”‚   â”œâ”€â”€ RC è®¾ç½® (ON/OFF)
â”‚   â”œâ”€â”€ é€šä¿¡çŠ¶æ€æ ‡ç­¾
â”‚   â””â”€â”€ è¿æ¥/æ–­å¼€æŒ‰é’®
â”œâ”€â”€ Tab æ§ä»¶åŒºåŸŸ
â”‚   â”œâ”€â”€ Torque Plot æ ‡ç­¾é¡µ (å›¾è¡¨æ˜¾ç¤º)
â”‚   â”œâ”€â”€ CAN Messages æ ‡ç­¾é¡µ (CANæŠ¥æ–‡)
â”‚   â””â”€â”€ FFB Analysis æ ‡ç­¾é¡µ (åŠ›åé¦ˆåˆ†æ)
â””â”€â”€ èœå•æ 
    â””â”€â”€ è®¾ç½®èœå•
        â””â”€â”€ æ—¥å¿—é…ç½®
```

### 2. æ“ä½œæµç¨‹

#### å¯åŠ¨æµç¨‹ï¼š
1. ç¨‹åºå¯åŠ¨ â†’ æ˜¾ç¤ºä¸»ç•Œé¢
2. ç”¨æˆ·è®¾ç½®é…ç½®é€‰é¡¹ (WiFi/CAN/AC/RC)
3. ç‚¹å‡» "ğŸŸ¢ Connect" æŒ‰é’®
4. ç³»ç»Ÿä¿å­˜é…ç½®åˆ°æœ¬åœ°æ–‡ä»¶
5. æ ¹æ®é…ç½®å¯åŠ¨ç›¸åº”æ¨¡å—ï¼š
   - å¦‚æœå¯ç”¨ CAN â†’ å¯åŠ¨ CAN è¯»å–çº¿ç¨‹
   - å¦‚æœå¯ç”¨ WiFi â†’ å¯åŠ¨ WiFi æ¨¡å—
   - å¦‚æœå¯ç”¨ AC â†’ å¯åŠ¨æ¸¸æˆæ¥å£
   - å¦‚æœå¯ç”¨ RC â†’ å¯åŠ¨ RC æ¨¡å—

#### è¿è¡Œæ—¶æµç¨‹ï¼š
1. CAN æ•°æ®è¯»å–çº¿ç¨‹æŒç»­è¿è¡Œ
2. è¯»å–åˆ° CAN å¸§æ•°æ® â†’ å­˜å‚¨åˆ° [can_data](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0) åˆ—è¡¨
3. åŒæ—¶æ›´æ–° CAN Messages é¡µé¢æ˜¾ç¤º
4. ä¸»çº¿ç¨‹å®šæ—¶æ›´æ–°å›¾è¡¨ (500ms é—´éš”)
5. ç”¨æˆ·å¯åˆ‡æ¢ä¸åŒæ ‡ç­¾é¡µæŸ¥çœ‹ä¸åŒä¿¡æ¯

#### æ–­å¼€æµç¨‹ï¼š
1. ç‚¹å‡» "ğŸ”´ Disconnect" æŒ‰é’®
2. è®¾ç½®åœæ­¢æ ‡å¿—ç»ˆæ­¢æ‰€æœ‰çº¿ç¨‹
3. é‡ç½®æ‰€æœ‰çŠ¶æ€å’Œæ•°æ®
4. å…³é—­ CAN è®¾å¤‡è¿æ¥
5. æŒ‰é’®å˜å› "ğŸŸ¢ Connect" çŠ¶æ€

## æµç¨‹å›¾

```mermaid
flowchart TD
    A[ç¨‹åºå¯åŠ¨] --> B[æ˜¾ç¤ºä¸»ç•Œé¢]
    B --> C[ç”¨æˆ·è®¾ç½®é…ç½®é€‰é¡¹]
    C --> D[ç‚¹å‡»è¿æ¥æŒ‰é’®]
    
    D --> E{å¯ç”¨CAN?}
    E -->|æ˜¯| F[å¯åŠ¨CANè¯»å–çº¿ç¨‹]
    E -->|å¦| G[è·³è¿‡CANåˆå§‹åŒ–]
    
    D --> H{å¯ç”¨WiFi?}
    H -->|æ˜¯| I[å¯åŠ¨WiFiæ¨¡å—]
    H -->|å¦| J[è·³è¿‡WiFiåˆå§‹åŒ–]
    
    D --> K{å¯ç”¨AC?}
    K -->|æ˜¯| L[å¯åŠ¨æ¸¸æˆæ¥å£]
    K -->|å¦| M[ä½¿ç”¨æ¨¡æ‹Ÿæ¥å£]
    
    D --> N{å¯ç”¨RC?}
    N -->|æ˜¯| O[å¯åŠ¨RCæ¨¡å—]
    N -->|å¦| P[è·³è¿‡RCåˆå§‹åŒ–]
    
    F --> Q[CANçº¿ç¨‹å¾ªç¯è¯»å–æ•°æ®]
    Q --> R[å­˜å‚¨CANå¸§åˆ°can_data]
    R --> S[æ›´æ–°CANæ¶ˆæ¯é¡µé¢]
    S --> Q
    
    Q --> T{ç”¨æˆ·ç‚¹å‡»æ–­å¼€?}
    T -->|å¦| Q
    T -->|æ˜¯| U[è®¾ç½®åœæ­¢æ ‡å¿—]
    U --> V[ç­‰å¾…çº¿ç¨‹ç»“æŸ]
    V --> W[é‡ç½®æ‰€æœ‰çŠ¶æ€]
    W --> X[å…³é—­è®¾å¤‡è¿æ¥]
    X --> Y[æŒ‰é’®å˜å›è¿æ¥çŠ¶æ€]
    
    subgraph å®æ—¶æ›´æ–°
        Z[å®šæ—¶å™¨500ms] --> AA[æ›´æ–°å›¾è¡¨æ˜¾ç¤º]
        AA --> Z
    end
    
    subgraph æ ‡ç­¾é¡µåˆ‡æ¢
        AB[åˆ‡æ¢æ ‡ç­¾é¡µ] --> AC{åˆ‡æ¢åˆ°å“ªä¸ªé¡µé¢?}
        AC -->|Torque Plot| AD[æ˜¾ç¤ºåŠ›çŸ©å›¾è¡¨]
        AC -->|CAN Messages| AE[æ˜¾ç¤ºCANæŠ¥æ–‡]
        AC -->|FFB Analysis| AF[æ˜¾ç¤ºåŠ›åé¦ˆåˆ†æ]
    end
```

### 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 3.1 è¿æ¥æ§åˆ¶é€»è¾‘
```python
# è¿æ¥/æ–­å¼€åˆ‡æ¢
def toggle_connection(self):
    if self.is_connected:  # å½“å‰å·²è¿æ¥ï¼Œæ‰§è¡Œæ–­å¼€æ“ä½œ
        self.conn_status_label.setText("Communication: âšª Disconnected")
        self.toggle_conn_button.setText("ğŸŸ¢ Connect")
        self.reset_all_states()  # é‡ç½®æ‰€æœ‰çŠ¶æ€
    else:  # å½“å‰å·²æ–­å¼€ï¼Œæ‰§è¡Œè¿æ¥æ“ä½œ
        self.conn_status_label.setText("Communication: ğŸŸ¢ Connected")
        self.toggle_conn_button.setText("ğŸ”´ Disconnect")
        self.start_can_reader()  # å¯åŠ¨CANè¯»å–
```

#### 3.2 CAN æ•°æ®å¤„ç†æµç¨‹
```python
# CANè¯»å–çº¿ç¨‹
def start_can_reader(self):
    def can_reader():
        while not self.can_reader_stop_flag and self.is_connected:
            # è¯»å–CANæ•°æ®
            # æ›´æ–°can_dataåˆ—è¡¨
            # è°ƒç”¨can_message_page.append_message()æ›´æ–°æ˜¾ç¤º
            time.sleep(0.01)
```

#### 3.3 çº¿ç¨‹å®‰å…¨çš„æ¶ˆæ¯æ˜¾ç¤º
```python
# CanMessagePageä¸­çš„çº¿ç¨‹å®‰å…¨æ›´æ–°
def append_message(self, message: str):
    self.message_received.emit(message)  # å‘å°„ä¿¡å·
    
def _append_message_thread_safe(self, message: str):
    self.text_edit.append(message)  # åœ¨GUIçº¿ç¨‹ä¸­æ›´æ–°UI
```

### 4. çŠ¶æ€ç®¡ç†

#### 4.1 é…ç½®çŠ¶æ€
- [USE_WIFI](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): æ˜¯å¦å¯ç”¨WiFié€šä¿¡
- [USE_REAL_CAN](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): æ˜¯å¦ä½¿ç”¨çœŸå®CANè®¾å¤‡
- [USE_REAL_AC](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): æ˜¯å¦è¿æ¥çœŸå®æ¸¸æˆ
- [USE_RC](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): æ˜¯å¦ä½¿ç”¨RCé¥æ§å™¨

#### 4.2 è¿è¡ŒçŠ¶æ€
- [is_connected](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): é€šä¿¡è¿æ¥çŠ¶æ€
- [can_reader_stop_flag](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): CANè¯»å–çº¿ç¨‹åœæ­¢æ ‡å¿—
- [config_ready_event](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): é…ç½®å°±ç»ªäº‹ä»¶

#### 4.3 æ•°æ®çŠ¶æ€
- [can_data](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): å­˜å‚¨æ¥æ”¶åˆ°çš„CANå¸§
- [torque_data](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): å­˜å‚¨åŠ›çŸ©ç›¸å…³æ•°æ®
- [is_plot_visible](file://c:\Users\Administrator\Desktop\g112RC730\gui.py#L0-L0): å›¾è¡¨æ˜¯å¦å¯è§

è¿™ä¸ªè®¾è®¡å®ç°äº†æ¨¡å—åŒ–çš„çŠ¶æ€ç®¡ç†ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ–¹å¼åè°ƒå„ä¸ªç»„ä»¶çš„å·¥ä½œã€‚

#### 4.4 çº¿ç¨‹çŠ¶æ€
wifiã€can\ac\rcæ¨¡å—çš„å¯åŠ¨å’Œåœæ­¢é€šè¿‡çº¿ç¨‹å®ç°ï¼Œé€šè¿‡æ ‡å¿—ä½æ§åˆ¶çº¿ç¨‹çš„è¿è¡Œå’Œåœæ­¢ã€‚
çº¿ç¨‹çš„çŠ¶æ€ç®¡ç†é€šè¿‡æ ‡å¿—ä½å®ç°ï¼Œé€šè¿‡æ ‡å¿—ä½æ§åˆ¶çº¿ç¨‹çš„è¿è¡Œå’Œåœæ­¢ã€‚
